<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointments - Televet Health (Vet)</title>
    <link rel="stylesheet" href="css/sidebar-layout.css">
    <link rel="stylesheet" href="css/profile-loading.css">
    <link rel="stylesheet" href="css/appointments.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Lalezar" rel="stylesheet">
    <style>body { visibility: hidden; }</style>
</head>
<body>
    <div class="profile-loading-overlay loading-animation" aria-hidden="true">
        <div class="loader">
            <div class="wrapper">
                <div class="catContainer">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 733 673" class="catbody">
                        <path fill="#212121" d="M111.002 139.5C270.502 -24.5001 471.503 2.4997 621.002 139.5C770.501 276.5 768.504 627.5 621.002 649.5C473.5 671.5 246 687.5 111.002 649.5C-23.9964 611.5 -48.4982 303.5 111.002 139.5Z"/>
                        <path fill="#212121" d="M184 9L270.603 159H97.3975L184 9Z"/>
                        <path fill="#212121" d="M541 0L627.603 150H454.397L541 0Z"/>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 158 564" class="tail">
                        <path fill="#191919" d="M5.97602 76.066C-11.1099 41.6747 12.9018 0 51.3036 0V0C71.5336 0 89.8636 12.2558 97.2565 31.0866C173.697 225.792 180.478 345.852 97.0691 536.666C89.7636 553.378 73.0672 564 54.8273 564V564C16.9427 564 -5.4224 521.149 13.0712 488.085C90.2225 350.15 87.9612 241.089 5.97602 76.066Z"/>
                    </svg>
                    <div class="text"><span class="bigzzz">Z</span><span class="zzz">Z</span></div>
                </div>
                <div class="wallContainer">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 500 126" class="wall">
                        <line stroke-width="6" stroke="#7C7C7C" x1="50" y1="3" x2="450" y2="3"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="100" y1="85" x2="400" y2="85"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="125" y1="122" x2="375" y2="122"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="0" y1="43" x2="500" y2="43"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="115.5" y1="43" x2="115.5" y2="2"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="189" y1="43" x2="189" y2="2"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="262.5" y1="43" x2="262.5" y2="2"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="336" y1="43" x2="336" y2="2"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="409.5" y1="43" x2="409.5" y2="2"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="153" y1="84" x2="153" y2="43"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="228" y1="84" x2="228" y2="43"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="303" y1="84" x2="303" y2="43"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="378" y1="84" x2="378" y2="43"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="192" y1="125" x2="192" y2="84"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="267" y1="125" x2="267" y2="84"/>
                        <line stroke-width="6" stroke="#7C7C7C" x1="342" y1="125" x2="342" y2="84"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="dashboard.html" class="sidebar-brand">Televet Health</a>
            <div class="sidebar-tagline">Veterinarian Portal</div>
        </div>
        <div class="user-profile">
            <a href="profile.html" class="user-profile-link">
                <div class="user-info">
                    <div class="user-avatar">
                        <img id="sidebar-avatar-img" class="user-avatar-img is-hidden" alt="Profile photo">
                        <span class="user-avatar-initials" id="sidebar-avatar">V</span>
                    </div>
                    <div class="user-text">
                        <div class="user-name" id="sidebar-name">Veterinarian</div>
                        <div class="user-email"><i class="fa fa-envelope"></i> <span id="sidebar-email">vet@example.com</span></div>
                    </div>
                </div>
            </a>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item"><i class="fa fa-th-large"></i> Dashboard</a>
            <a href="appointments.html" class="nav-item active"><i class="fa fa-calendar"></i> Appointments</a>
            <a href="messages.html" class="nav-item"><i class="fa fa-envelope"></i> Messages</a>
            <a href="patients.html" class="nav-item"><i class="fa fa-paw"></i> Patients</a>
        </nav>
        <nav class="footer-nav">
            <a href="admin.html" class="nav-item"><i class="fa fa-users"></i> Administration</a>
        </nav>
        <div class="logout-section">
            <button id="logout-btn" class="logout-btn"><i class="fa fa-sign-out"></i> Logout</button>
        </div>
    </aside>

    <main class="main-content">
        <header class="app-top-header">
            <div class="header-left">
                <button class="mobile-menu-toggle" aria-label="Toggle Menu"><i class="fa fa-bars"></i></button>
                <span class="role-badge"><i class="fa fa-stethoscope" aria-hidden="true"></i> Veterinarian</span>
            </div>
            <div class="header-right">
                <button type="button" class="dark-mode-toggle" aria-label="Toggle dark mode"><i class="fa fa-moon-o" aria-hidden="true"></i></button>
                <button type="button" class="profile-header-btn" aria-label="Profile"><i class="fa fa-user-circle" aria-hidden="true"></i></button>
            </div>
        </header>
        <div class="page-header">
            <h1 class="page-title">Appointments</h1>
            <p class="page-subtitle">Manage availability templates and view your schedules</p>
        </div>
        <div class="content-wrapper">
            <!-- Availability Templates -->
            <section class="appointments-section appointments-templates-section" aria-labelledby="templates-heading">
                <div class="appointments-section-header">
                    <h2 id="templates-heading" class="appointments-section-title">
                        <i class="fa fa-file-text-o" aria-hidden="true"></i> Availability Templates
                    </h2>
                    <p class="appointments-section-desc">Define weekly or daily availability. Apply to date ranges to generate schedules.</p>
                    <button type="button" class="appointments-create-btn" id="template-create-btn" aria-label="Create template">
                        <i class="fa fa-plus" aria-hidden="true"></i> Create template
                    </button>
                </div>
                <div id="appointments-templates-list-wrap" class="appointments-templates-wrap">
                    <div class="appointments-templates-list" id="appointments-templates-list" aria-live="polite"></div>
                    <div class="appointments-empty is-hidden" id="appointments-empty" aria-live="polite">
                        <i class="fa fa-calendar-plus-o" aria-hidden="true"></i>
                        <p>No templates yet</p>
                        <span class="appointments-empty-hint">Create a week or day template to define your availability.</span>
                    </div>
                </div>
            </section>
            <div class="appointments-partition-horizontal" aria-hidden="true"></div>
            <!-- Schedules -->
            <section class="appointments-schedules-section" aria-labelledby="schedules-heading">
                <div class="schedules-section-header">
                    <h2 id="schedules-heading" class="appointments-section-title">
                        <i class="fa fa-calendar-o" aria-hidden="true"></i> Schedules
                    </h2>
                    <div class="schedules-view-controls">
                        <div class="schedules-filter-row">
                            <label for="schedules-filter">Date</label>
                            <select id="schedules-filter" aria-label="Filter schedules by date">
                                <option value="all">All schedules</option>
                                <option value="today">Today</option>
                                <option value="date">Specific date</option>
                            </select>
                            <div id="schedules-date-wrap" class="schedules-date-wrap is-hidden">
                                <input type="date" id="schedules-date-picker" aria-label="Select date">
                            </div>
                        </div>
                        <div class="schedules-slot-filter">
                            <button type="button" class="schedules-slot-btn active" id="schedules-slot-all" data-slot-filter="all">All</button>
                            <button type="button" class="schedules-slot-btn" id="schedules-slot-available" data-slot-filter="available">Available</button>
                            <button type="button" class="schedules-slot-btn" id="schedules-slot-booked" data-slot-filter="booked">Booked</button>
                        </div>
                    </div>
                </div>
                <div id="schedules-view-empty" class="schedules-view-empty">
                    <i class="fa fa-calendar-o" aria-hidden="true"></i>
                    <p>No schedules to display</p>
                    <span class="schedules-view-empty-hint">Apply a template to a date range first to generate schedules.</span>
                </div>
                <div id="schedules-view-wrap" class="schedules-view-wrap is-hidden">
                    <div id="schedules-list" class="schedules-list"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Template View Modal -->
    <div class="template-view-overlay is-hidden" id="template-view-overlay" aria-hidden="true"></div>
    <div class="template-view-modal is-hidden" id="template-view-modal" role="dialog" aria-labelledby="template-view-title" aria-modal="true">
        <div class="template-modal-card">
            <div class="template-modal-header">
                <h2 class="template-modal-title" id="template-view-title">Template</h2>
                <button type="button" class="template-modal-close" id="template-view-close" aria-label="Close"><i class="fa fa-times" aria-hidden="true"></i></button>
            </div>
            <div class="template-modal-body">
                <p class="template-view-type" id="template-view-type"></p>
                <div class="template-view-schedule" id="template-view-schedule"></div>
            </div>
            <div class="template-modal-footer">
                <button type="button" class="btn-cancel" id="template-view-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Template Create/Edit Modal -->
    <div class="template-modal-overlay is-hidden" id="template-modal-overlay" aria-hidden="true"></div>
    <div class="template-modal is-hidden" id="template-modal" role="dialog" aria-labelledby="template-modal-title" aria-modal="true">
        <div class="template-modal-card">
            <div class="template-modal-header">
                <h2 class="template-modal-title" id="template-modal-title">Create availability template</h2>
                <button type="button" class="template-modal-close" id="template-modal-close" aria-label="Close"><i class="fa fa-times" aria-hidden="true"></i></button>
            </div>
            <div class="template-modal-body">
                <div class="template-form-row">
                    <div class="template-form-group">
                        <label for="template-name">Template name</label>
                        <input type="text" id="template-name" placeholder="e.g. Regular Shift" maxlength="80" autocomplete="off">
                    </div>
                    <div class="template-form-group">
                        <label>Type</label>
                        <div class="template-type-options">
                            <label class="template-type-option" id="template-type-week-wrap">
                                <input type="radio" name="template-type" value="week" id="template-type-week" checked> Week template
                            </label>
                            <label class="template-type-option" id="template-type-day-wrap">
                                <input type="radio" name="template-type" value="day" id="template-type-day"> Day template
                            </label>
                        </div>
                    </div>
                </div>
                <div id="template-week-section" class="template-week-layout">
                    <div class="template-days-panel">
                        <h3>Days of the week</h3>
                        <div id="template-days-list"></div>
                    </div>
                    <div class="template-availability-panel">
                        <p class="template-panel-hint">Add exact meeting times for the selected day.</p>
                        <div class="template-copy-row template-copy-unified">
                            <div class="template-copy-radio-wrap">
                                <label class="template-copy-radio"><input type="radio" name="template-copy-source" value="day" checked> Day</label>
                                <label class="template-copy-radio"><input type="radio" name="template-copy-source" value="template"> Template</label>
                            </div>
                            <select id="template-copy-source-select" aria-label="Copy from"></select>
                            <button type="button" class="template-copy-btn" id="template-copy-week-btn"><i class="fa fa-copy" aria-hidden="true"></i> Copy</button>
                        </div>
                        <button type="button" class="template-add-slot-btn" id="template-add-slot-btn"><i class="fa fa-plus" aria-hidden="true"></i> Add time slot</button>
                        <div class="template-slots-header template-slot-row">
                            <div class="template-slot-time-wrap"><span>Start</span></div>
                            <div class="template-slot-time-wrap"><span>End</span></div>
                            <span class="template-slot-col-delete" aria-hidden="true"></span>
                        </div>
                        <div class="template-slots-list" id="template-slots-list"></div>
                    </div>
                </div>
                <div id="template-day-section" class="template-day-layout is-hidden">
                    <div class="template-availability-panel">
                        <p class="template-panel-hint">Add exact meeting times for this template.</p>
                        <div class="template-copy-row">
                            <label for="template-copy-from-template">Copy from template</label>
                            <select id="template-copy-from-template" aria-label="Copy slots from another day template">
                                <option value="">— Select template —</option>
                            </select>
                            <button type="button" class="template-copy-btn" id="template-copy-from-template-btn"><i class="fa fa-copy" aria-hidden="true"></i> Copy</button>
                        </div>
                        <button type="button" class="template-add-slot-btn" id="template-day-add-slot-btn"><i class="fa fa-plus" aria-hidden="true"></i> Add time slot</button>
                        <div class="template-slots-header template-slot-row">
                            <div class="template-slot-time-wrap"><span>Start</span></div>
                            <div class="template-slot-time-wrap"><span>End</span></div>
                            <span class="template-slot-col-delete" aria-hidden="true"></span>
                        </div>
                        <div class="template-slots-list" id="template-day-slots-list"></div>
                    </div>
                </div>
                <p class="template-error-msg is-hidden" id="template-error-msg" role="alert"></p>
            </div>
            <div class="template-modal-footer">
                <button type="button" class="btn-cancel" id="template-cancel-btn">Cancel</button>
                <button type="button" class="btn-save" id="template-save-btn">Save template</button>
            </div>
        </div>
    </div>

    <!-- Conflict Warning Modal (CASE 2: overlap without bookings) -->
    <div class="template-modal-overlay is-hidden" id="conflict-modal-overlay" aria-hidden="true"></div>
    <div class="template-modal is-hidden" id="conflict-modal" role="dialog" aria-labelledby="conflict-modal-title" aria-modal="true">
        <div class="template-modal-card">
            <div class="template-modal-header">
                <h2 class="template-modal-title" id="conflict-modal-title"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Schedule conflict</h2>
                <button type="button" class="template-modal-close" id="conflict-modal-close" aria-label="Close"><i class="fa fa-times" aria-hidden="true"></i></button>
            </div>
            <div class="template-modal-body">
                <p class="conflict-modal-message" id="conflict-modal-message">Some template time slots conflict with existing slots on the selected date(s). The conflicting slots are empty (no appointments booked).</p>
                <p class="conflict-modal-choices">Choose how to proceed:</p>
                <div class="conflict-modal-actions">
                    <button type="button" class="btn-save" id="conflict-replace-btn"><i class="fa fa-refresh" aria-hidden="true"></i> Replace entire day schedule</button>
                    <button type="button" class="btn-cancel" id="conflict-cancel-btn"><i class="fa fa-times" aria-hidden="true"></i> Cancel and keep current schedule</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Apply Template Modal -->
    <div class="template-modal-overlay is-hidden" id="apply-modal-overlay" aria-hidden="true"></div>
    <div class="template-modal is-hidden" id="apply-modal" role="dialog" aria-labelledby="apply-modal-title" aria-modal="true">
        <div class="template-modal-card">
            <div class="template-modal-header">
                <h2 class="template-modal-title" id="apply-modal-title">Apply template to date range</h2>
                <button type="button" class="template-modal-close" id="apply-modal-close" aria-label="Close"><i class="fa fa-times" aria-hidden="true"></i></button>
            </div>
            <div class="template-modal-body">
                <p class="apply-template-name-wrap">Template: <strong id="apply-template-name">—</strong></p>
                <p class="template-panel-hint">Select a date range. Schedules will be created per calendar date, matching each date's weekday.</p>
                <div class="template-form-row">
                    <div class="template-form-group">
                        <label for="apply-start-date">Start date</label>
                        <input type="date" id="apply-start-date" aria-label="Start date">
                    </div>
                    <div class="template-form-group">
                        <label for="apply-end-date">End date</label>
                        <input type="date" id="apply-end-date" aria-label="End date">
                    </div>
                </div>
                <p class="template-error-msg is-hidden" id="apply-error-msg" role="alert"></p>
            </div>
            <div class="template-modal-footer">
                <button type="button" class="btn-cancel" id="apply-cancel-btn">Cancel</button>
                <button type="button" class="btn-save" id="apply-submit-btn">Apply</button>
            </div>
        </div>
    </div>

    <script src="js/sidebar.js"></script>
    <script type="module" src="js/dashboard-auth.js"></script>
    <script type="module" src="js/profile.js"></script>
    <script type="module" src="js/appointments.js"></script>
</body>
</html>
